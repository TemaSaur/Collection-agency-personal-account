<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—è–∫ –ö–æ–ª–ª–µ–∫—Ç - –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js" integrity="sha512-d6sc8kbZEtA2LwB9m/ck0FhvyUwVfdmvTeyJRprmj7Wg9wRFtHDIpr6qk4g/y3Ix3O9I6KHIv6SGu9f7RaP1Gw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<header>
    <div class="container flex between">
        <a href="/"><span class="fancy big">–ú–∞—è–∫ –ö–æ–ª–ª–µ–∫—Ç</span></a>
        <div class="user flex gap-2 align">
            <span th:if="${name != null}">
                <span class="total" th:text="${totalSum}"></span>
            </span>
            <span class="name"><a href="/edit-info" th:if="${name != null}">
                <span th:text="${name}" /></a>
            </span>
            <a href="/logout">–í—ã–π—Ç–∏</a>
        </div>
    </div>
</header>

<main>
    <div class="container pad">
        <h1>–í–∞—à–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å</h1>
        <div th:if="${name != null}">
            <div class="layout">
                <div class="data">
                    <h3>–ó–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:</h3>
                    <div class="tables">
                        <div class="table" th:each="debt: ${debts}">
                            <p class="key">–°—É–º–º–∞ –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–∏:</p>
                            <p class="value"><span th:text="${debt.getAmount()}"></span> ‚ÇΩ</p>

                            <p class="key">–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∫—Ä–µ–¥–∏—Ç–æ—Ä:</p>
                            <p class="value"><span th:text="${debt.getCreditor()}"></span></p>

                            <div th:if="${debt.isRepaid()}" class="key">–û–ø–ª–∞—á–µ–Ω</div>
                            <div th:unless="${debt.isRepaid()}">
                                <a th:href="@{'/debts/' + ${debt.getId()} + '/repaid'}">–û–ø–ª–∞—Ç–∏—Ç—å</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-parent gap-2 flex align">
                    <div class="chart" id="chart">
                    </div>
                    <div class="markers">
                        <div class="marker">
                            <span class="mark color1"></span>
                            <div class="text">–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞: <span class="number" th:text="${left}"></span> ‚ÇΩ</div>
                        </div>
                        <div class="marker">
                            <span class="mark color2"></span>
                            <div class="text">–û–ø–ª–∞—á–µ–Ω–æ: <span class="number" th:text="${paid}"></span> ‚ÇΩ</div>
                        </div>
                        <div class="marker">
                            <span class="mark color3"></span>
                            <div class="text">–ü—Ä–æ—â–µ–Ω–æ: <span class="number" th:text="${sorry}"></span> ‚ÇΩ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${name == null}">
            <a href="/edit-info">–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</a>
        </div>
    </div>
</main>
<footer>
    <div class="container">
        <div class="fancy spaceout">–ú–∞—è–∫ –ö–æ–ª–ª–µ–∫—Ç</div>
        <div class="flex between">
            <div class="links">
                <p><a href="http://mayak-kollekt.ru/#about">–û –∫–æ–º–ø–∞–Ω–∏–∏</a></p>
                <p><a href="http://mayak-kollekt.ru/#services">–£—Å–ª—É–≥–∏</a></p>
                <p><a href="http://mayak-kollekt.ru/#contact">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></p>
                <p><a href="http://mayak-kollekt.ru/payment">–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å?</a></p>
            </div>
            <div class="copyright">
                &copy; 2024 "–ú–ê–Ø–ö –ö–û–õ–õ–ï–ö–¢"
            </div>
            <div class="contact">
                üìû +7 800 555 35 35
            </div>
        </div>
    </div>
</footer>

<script>
    function setup() {
        const data = [...document.querySelectorAll('.marker .number')].map(e => +(e.textContent.replace('{', '').replace('}', '')))

        const colors = [
            '#3053BC',
            '#172859',
            '#B0C0F1',
        ]
        const sum = data[0] + data[1] + data[2];

        const size = 278, strokeWidth = 3
        const canvas = createCanvas(size, size)
        canvas.parent('chart')

        strokeWeight(strokeWidth)
        stroke(255)

        let angle = -HALF_PI
        for (let i = 0; i < 3; ++i) {
            fill(colors[i])

            const endAngle = angle + (PI * 2) * data[i] / sum;
            arc(size / 2, size / 2, size - strokeWidth, size - strokeWidth, angle, endAngle, PIE)
            angle = endAngle
        }
    }
</script>
</body>
</html>